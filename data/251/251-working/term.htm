<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
	<meta charset="utf-8">
  <meta name="generator" content="CoffeeCup HTML Editor (www.coffeecup.com)">
  <meta name="dcterms.created" content="Mon, 17 Feb 2014 01:03:04 GMT">
  <meta name="description" content="">
  <meta name="keywords" content="">
	<title>Term</title>

<script language="JavaScript">

//var keybuf = "";
var CommandConnect;

function jload() {

	LoadCommandConnect();

  document.testform.t.value+= '';

  if (document.addEventListener) {
     document.addEventListener("keydown",keydown,false);
//       document.addEventListener("keypress",keypress,false);
//       document.addEventListener("keyup",keyup,false);
//       document.addEventListener("textInput",textinput,false);
  } else if (document.attachEvent) {
     document.attachEvent("onkeydown", keydown);
//       document.attachEvent("onkeypress", keypress);
//       document.attachEvent("onkeyup", keyup);
//       document.attachEvent("ontextInput", textinput);
  } else {
  	document.onkeydown= keydown;
//       document.onkeypress= keypress;
//       document.onkeyup= keyup;
//       document.ontextinput= textinput;   // probably doesn't work
  }

//	iTimer = setInterval(function(){timerhandler()},333);

  document.testform.t.value = "\r\n>";

	document.testform.t.focus();

}

// Create a connection to the server command
function LoadCommandConnect() {
	// Create a connection to the server.
	CommandConnect = new XMLHttpRequest();
}

function GetCommandConnect(command) {
	
	// Set up the event handler for the asynchronous data request.
	CommandConnect.onreadystatechange = ProcessCommandChange;
	var sendstr = "command.txt?CMD=" + command;

//	sendstr.replace(/[^a-z0-9]/gi,'')
//	sendstr.replace("%3E",'')

	CommandConnect.open("GET", sendstr , true);
	CommandConnect.send();
}

function ProcessCommandChange() {
	// Check the return status.
	if ((CommandConnect.readyState == 4) && (CommandConnect.status == 200)) {
		var rtext = CommandConnect.responseText;

    document.testform.t.value += rtext;
		document.testform.t.scrollTop = document.testform.t.scrollHeight;
	} // End if have data
}

function keydown(e) {
var key;
//   if (!e) e= event;

//	console.log("Got key " + e.key);
//	console.log("Got key code " + e.keyCode);

	if (e.keyCode == 13) {
//		console.log("Got cr " + keybuf);
		// Display last command
//    document.testform.t.value += keybuf;

		var arrayOfLines = document.testform.t.value.split('\n');
		var keybuf1 = arrayOfLines[arrayOfLines.length-1];
		var keybuf2 = keybuf1.split('>');

//		alert ("Key buf " + keybuf2[keybuf2.length-1]);

		GetCommandConnect(keybuf2[keybuf2.length-1]);
	}
//		keybuf = "";
//	} else {
//		key = String.fromCharCode(e.keyCode);

//		keybuf = keybuf + e.key;
//		keybuf = keybuf + key;
//	}
	return false;
}

</script>

</head>

<body onload="jload();">

<noscript>Javascript is essential for this page.  Please use a browser 
that supports Javascript.</noscript>

<form name="testform">

<textarea name="t" rows="25" cols="90"></textarea>

</form>

</body>
</html>
