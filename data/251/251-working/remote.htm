<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="CoffeeCup HTML Editor (www.coffeecup.com)">
    <meta name="dcterms.created" content="Mon, 22 Sep 2014 20:31:07 GMT">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <title>Remote</title>
    
    <!--[if IE]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  

	<script language="JavaScript">
      
		var RemoteConnect;
		var RemoteConnectSearch;
		var SaveConnect;

		// Called when page loads
		function Jload() {
			LoadRemoteConnectSearch();		// Set up connection for search
			LoadRemoteConnect();					// Set up connection
			GetRemoteConnect();						// Call this to update variables
			LoadSaveConnect();						// Save id command
		} // End jload

		// Create a connection to the server.
		function LoadSaveConnect() {
			SaveConnect = new XMLHttpRequest();
		} // End LoadSaveConnect

		// Create a connection to the server.
		function LoadRemoteConnect() {
			// Create a connection to the server.
			RemoteConnect = new XMLHttpRequest();
		} // End LoadRemoteConnect

		// Create a connection to the server for search.
		function LoadRemoteConnectSearch() {
			// Create a connection to the server.
			RemoteConnectSearch = new XMLHttpRequest();
		} // End LoadRemoteConnectSearch


		// Called on load to get original settings
		function GetRemoteConnect() {
			// Set up the event handler for the asynchronous data request.
			RemoteConnect.onreadystatechange = ProcessTextChange;

			// Create the request and send it.
			RemoteConnect.open("GET", "remote.txt", true);		 // The file to get remote.txt
			RemoteConnect.send();
		} // End GetRemoteConnect

		// Call from "Submit" button 
		function PostRemoteConnect()	{

			// Set up the event handler for the asynchronous data request.
			RemoteConnect.onreadystatechange = ProcessTextChange;

			var sendstr = "remote.txt?Mcast=" + document.getElementById("IdMcast").value;
	
			sendstr = sendstr.replace( /\s/g, ""); 
			RemoteConnect.open("GET", sendstr, true);		 // The file to get scan set up ssu.txt
			RemoteConnect.send();
		} // End PostRemoteConnect

		// Handle data sent back from device
		function ProcessTextChange() {

			// Check the return status.
			if ((RemoteConnect.readyState == 4) && (RemoteConnect.status == 200))	{
				var rtext = RemoteConnect.responseText;
				// Expect MCAST=<val>
				var vars = rtext.split("&");		  // Group all the variables sorted by the &

				// MCAST=<val>
				var mcastval = vars[0].split("=");
				document.getElementById("IdMcast").value = mcastval[1];		
			} // End if have data
		} // End ProcessTextChange

		// Start a search for remove devices
		function StartSearch() {
			GetRemoteConnectSearch();
		}

		// Handle data sent back from mfind
		function ProcessTextChangeSearch() {
			var i;

			// Check the return status.
			if ((RemoteConnectSearch.readyState == 4) && (RemoteConnectSearch.status == 200))	{
				var rtext = RemoteConnectSearch.responseText;
				// Expect NUMDEV=<numdev>&
				var vars = rtext.split("&");		  // Group all the variables sorted by the &

				// NUMDEV
				var numdev = vars[0].split("=");

				if (numdev[1] > 0) {
					for (i=0 ; i<numdev[1] ; i++) {
						// Get the IP address
						var ipAdd = vars[(i*3)+1].split("=");

						var ptab = document.getElementById("mcasttab").rows[i+1].cells[1]; // base 0 row and cell
						ptab.innerHTML = ipAdd[1];

						// Get the serial number
						var ssn = vars[(i*3)+2].split("=");
						ptab = document.getElementById("mcasttab").rows[i+1].cells[0]; // base 0 row and cell
						ptab.innerHTML = ssn[1];

						// Get the NPR
						var npr = vars[(i*3)+3].split("=");
						ptab = document.getElementById("mcasttab").rows[i+1].cells[2]; // base 0 row and cell
						ptab.innerHTML = npr[1];
					} // End loop through all devices found
				} else { // End numdev > 0
					// Number of device is 0
					var ptab = document.getElementById("mcasttab").rows[1].cells[1]; // base 0 row and cell
					ptab.innerHTML = "No device found";
				}
			} // End if have data
		} // End ProcessTextChange

		// Called on click of search
		function GetRemoteConnectSearch() {
			// Set up the event handler for the asynchronous data request.
			RemoteConnectSearch.onreadystatechange = ProcessTextChangeSearch;

			// Create the request and send it.
			RemoteConnectSearch.open("GET", "mfind.txt", true);		 // The file to get mfind.txt
			RemoteConnectSearch.send();

			showRemoteSearch();
		} // End GetRemoteConnectSearch

		// Submit file search
		function StartFile() {
			// Could set up loop for multiple files
			var x = document.getElementById("myFile").files[0].name; 
			alert("StartFile " + x);
		}

  	function showRemoteSearch() {
			var w = window.open('','','_parent');
			w.document.write('Searching for remote devices. This page will automatically close in 4 seconds. Please do not leave this page while active');
			w.focus();
			setTimeout(function() {w.close();}, 4000);
		}

		function GetSaveConnect() {
			var sendstr;
			sendstr = "saveid.txt";

			// Set up the event handler for the asynchronous data request.
			SaveConnect.onreadystatechange = ProcessTextChangeSave;
	
			SaveConnect.open("GET", sendstr, true);		 // The file to do a save
			SaveConnect.send();
		} // End GetSaveConnect

		// Handle data sent back from device
		function ProcessTextChangeSave() {

			// Check the return status.
			if ((SaveConnect.readyState == 4) && (SaveConnect.status == 200))	{
				var rtext = SaveConnect.responseText;
			} // End have data
		} // End ProcessextChangeSave


	</script>
  
	<body onload="Jload();">
  
  	<div id="cmdarea"  style="height:40px; width:100%; border:4px; overflow:auto;">
 
  		<table id="cmdareatab" style="width:100%; border-collapse: collapse; border: 1px solid black; background-color: #7CA8E1;">
  			<tr>
				<td style="width:175px;"><a href="javascript:StartSearch()" style="text-decoration:none"><font color="blue" size = "4"><b>Find Remote Devices</b></font></a></td>
 				<td style="text-align:right;"><a href="javascript:GetSaveConnect()" style="text-decoration:none"><font color="blue"><b>Save</b></font></a></td>	
				</tr>
  		</table>
		</div>  

		<div id="remoteset" style="height:95px; width:100%; border:4px; overflow:auto; ">
			<table id="remotesettab" style="text-align:center; width:100%; border-collapse: collapse; border: 1px solid black; background-color: #B3C8E4;">
    		<tr><th style="text-align:center;">Multicast Settings</th></tr>
    		<tr><td style="text-align:center;">Multicast IP Address: <input type="text" id="IdMcast" size="12" value="224.1.1.11"></td></tr>
				<tr><td style="border: 1px solid black; text-align:center;"><input type="button" onclick="PostRemoteConnect()" value="Submit"></td></tr>
 			</table>
		</div>		 

		<div id="mcastresp" style=" height:200px; width:100%; border:1px solid #ccc; overflow:auto; background-color: #B3C8E4;">

			<table id="mcasttab" style="text-align:center; width:100%; border-collapse: collapse; border: 1px solid black; background-color: #B3C8E4;">

				<tr>
   			<th>Serial Number</th><th>IP Address</th><th>Nominal Pressure</th><th></th><th></th><th></th><th></th><th></th>
  			</tr>
  
  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>

  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>

  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>

  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>

  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>

  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>

  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>

  			<tr>
				<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
  			</tr>
  		</table>
		</div> 
	</body>
</html>